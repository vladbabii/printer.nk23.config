[manual_stepper probe_mount]
step_pin: z:P0.19
dir_pin: z:P0.20
enable_pin: !z:P2.8
microsteps: 16
full_steps_per_rotation: 200
rotation_distance: 40
velocity: 10
accel: 5
endstop_pin: z:P1.26

[tmc2209 manual_stepper probe_mount]
uart_pin: z:P3.25
run_current: 1
stealthchop_threshold: 0

[gcode_macro PROBE_MOUNT_NOW]
variable_homed: 0
gcode:
  M118 ProbeMount

[gcode_macro PROBE_MOUNT_ON]
gcode:
  MANUAL_STEPPER STEPPER=probe_mount ENABLE=1

[gcode_macro PROBE_MOUNT_OFF]
gcode:
  MANUAL_STEPPER STEPPER=probe_mount ENABLE=1

[gcode_macro PROBE_MOUNT_HOME]
gcode:
  PROBE_MOUNT_ON
  MANUAL_STEPPER STEPPER=probe_mount SET_POSITION=0 SPEED=3 MOVE=-50 STOP_ON_ENDSTOP=1
  SET_GCODE_VARIABLE MACRO=PROBE_MOUNT_NOW VARIABLE=homed VALUE=1

[gcode_macro PROBE_MOUNT_MOVE]
gcode:
  {% if params.POSITION is defined %}
    {% if printer['gcode_macro PROBE_MOUNT_NOW'].homed == 0 %}
        PROBE_MOUNT_HOME
    {% endif %}
    MANUAL_STEPPER STEPPER=probe_mount SPEED=3 MOVE={params.POSITION}
  {% else %}
    RESPOND PREFIX="info" MSG="ProbeMount > position parameter missing"
  {% endif %}